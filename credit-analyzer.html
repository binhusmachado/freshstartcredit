<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Credit Report Analyzer | Fresh Start Credit</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tesseract.js/4.1.1/tesseract.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        .header {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        .header h1 { font-size: 28px; margin-bottom: 10px; }
        .content { padding: 30px; }
        
        /* Login Screen */
        .login-screen {
            text-align: center;
            padding: 60px 30px;
            max-width: 400px;
            margin: 0 auto;
        }
        .login-screen h2 {
            color: #1e3c72;
            margin-bottom: 20px;
            font-size: 24px;
        }
        .password-input {
            max-width: 300px;
            margin: 0 auto;
        }
        .password-input input {
            width: 100%;
            padding: 15px;
            font-size: 18px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            text-align: center;
            letter-spacing: 3px;
            margin-bottom: 15px;
        }
        .password-input input:focus {
            outline: none;
            border-color: #1e3c72;
        }
        .btn {
            display: inline-block;
            padding: 12px 24px;
            background: #1e3c72;
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            cursor: pointer;
            transition: background 0.3s;
        }
        .btn:hover { background: #2a5298; }
        .btn-accent { background: #48bb78; }
        .btn-accent:hover { background: #38a169; }
        .error-msg {
            color: #dc3545;
            margin-top: 15px;
            display: none;
        }
        .hidden { display: none !important; }
        
        /* Tabs */
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        .tab {
            padding: 12px 20px;
            background: #f0f0f0;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }
        .tab.active {
            background: #1e3c72;
            color: white;
        }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        
        /* Upload Area */
        .upload-area {
            border: 3px dashed #ccc;
            border-radius: 12px;
            padding: 40px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            margin-bottom: 20px;
        }
        .upload-area:hover {
            border-color: #1e3c72;
            background: #f8f9fa;
        }
        .upload-area.dragover {
            border-color: #48bb78;
            background: #f0fff4;
        }
        
        /* Feature Cards */
        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        .feature-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid #1e3c72;
        }
        .feature-card h3 {
            color: #1e3c72;
            margin-bottom: 10px;
        }
        
        /* Forms */
        .form-group {
            margin-bottom: 15px;
        }
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #333;
        }
        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
        }
        .form-group textarea {
            resize: vertical;
            min-height: 100px;
        }
        
        /* Strategy Cards */
        .strategy-card {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 15px;
            cursor: pointer;
            transition: all 0.3s;
        }
        .strategy-card:hover {
            border-color: #1e3c72;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        .strategy-card.selected {
            border-color: #48bb78;
            background: #f0fff4;
        }
        .strategy-card h4 {
            color: #1e3c72;
            margin-bottom: 8px;
        }
        .strategy-card .badge {
            display: inline-block;
            padding: 4px 12px;
            background: #ed8936;
            color: white;
            border-radius: 20px;
            font-size: 12px;
            margin-bottom: 10px;
        }
        
        /* Letter Output */
        .letter-output {
            background: #f8f9fa;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
            white-space: pre-wrap;
            font-family: monospace;
            max-height: 500px;
            overflow-y: auto;
        }
        
        /* Alert Boxes */
        .alert {
            padding: 15px 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .alert-info {
            background: #e3f2fd;
            border-left: 4px solid #2196f3;
        }
        .alert-warning {
            background: #fff3e0;
            border-left: 4px solid #ff9800;
        }
        .alert-danger {
            background: #ffebee;
            border-left: 4px solid #f44336;
        }
        
        /* Bureau Cards */
        .bureau-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        .bureau-card {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
        }
        .bureau-card h4 {
            color: #1e3c72;
            margin-bottom: 10px;
        }
        .bureau-card a {
            display: inline-block;
            margin-top: 10px;
            color: #1e3c72;
            text-decoration: none;
            font-weight: 500;
        }
        
        /* Items List */
        .item-list {
            margin-top: 20px;
        }
        .item-row {
            display: flex;
            align-items: center;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            margin-bottom: 10px;
        }
        .item-row input[type="checkbox"] {
            margin-right: 15px;
            width: 20px;
            height: 20px;
        }
        .item-row label {
            flex: 1;
            cursor: pointer;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .tabs { flex-direction: column; }
            .tab { width: 100%; text-align: center; }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Login Screen -->
        <div id="loginScreen" class="login-screen">
            <h2>üîí Credit Analyzer</h2>
            <p>Enter access code to continue</p>
            <div class="password-input">
                <input type="password" id="accessCode" placeholder="Enter Code" maxlength="20">
                <button class="btn" onclick="checkLogin()" style="width: 100%;">Access Portal</button>
            </div>
            <p id="loginError" class="error-msg">Invalid access code. Please try again.</p>
            <p style="margin-top: 30px; color: #999; font-size: 12px;">Need access? Call (305) 747-3973</p>
        </div>

        <!-- Main App -->
        <div id="mainApp" class="hidden">
            <div class="header">
                <h1>üå± AI Credit Report Analyzer</h1>
                <p>Upload your credit report and generate dispute letters</p>
                <button class="btn" onclick="logout()" style="position: absolute; top: 20px; right: 20px;">Logout</button>
            </div>

            <div class="content">
                <!-- Tabs -->
                <div class="tabs">
                    <button class="tab active" onclick="switchTab('upload')">üì§ Upload Report</button>
                    <button class="tab" onclick="switchTab('manual')">‚úèÔ∏è Manual Entry</button>
                    <button class="tab" onclick="switchTab('client')">üë§ My Info</button>
                    <button class="tab" onclick="switchTab('strategies')">üéØ Strategies</button>
                    <button class="tab" onclick="switchTab('phantom')">üëª Phantom Bureaus</button>
                    <button class="tab" onclick="switchTab('letters')">üìù My Letters</button>
                </div>

                <!-- Upload Tab -->
                <div id="uploadTab" class="tab-content active">
                    <div class="alert alert-info">
                        <strong>üí° Tip:</strong> Upload your credit report from AnnualCreditReport.com. We support PDF, JPG, and PNG files.
                    </div>

                    <div class="upload-area" id="uploadArea" onclick="document.getElementById('fileInput').click()">
                        <div style="font-size: 48px; margin-bottom: 15px;">üìÑ</div>
                        <h3>Click to Upload Credit Report</h3>
                        <p>or drag and drop files here</p>
                        <p style="color: #999; font-size: 14px; margin-top: 10px;">PDF, JPG, PNG (Max 10MB)</p>
                        <input type="file" id="fileInput" accept=".pdf,.jpg,.jpeg,.png" style="display: none;" onchange="handleFileSelect(event)">
                    </div>

                    <div id="uploadStatus" class="hidden">
                        <div class="alert alert-info">
                            <strong>‚úÖ File uploaded:</strong> <span id="fileName"></span>
                        </div>
                        <div id="extractedItems" class="item-list hidden">
                            <h3>Detected Negative Items:</h3>
                            <div id="itemsList"></div>
                            <button class="btn btn-accent" onclick="generateLettersFromItems()" style="margin-top: 20px;">Generate Dispute Letters</button>
                        </div>
                    </div>
                </div>

                <!-- Manual Entry Tab -->
                <div id="manualTab" class="tab-content">
                    <h3>Manual Dispute Entry</h3>
                    
                    <div class="form-group">
                        <label>Account Type:</label>
                        <select id="itemType">
                            <option value="late_payment">Late Payment</option>
                            <option value="collection">Collection Account</option>
                            <option value="charge_off">Charge-Off</option>
                            <option value="inquiry">Hard Inquiry</option>
                            <option value="bankruptcy">Bankruptcy</option>
                            <option value="other">Other</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>Creditor Name:</label>
                        <input type="text" id="creditorName" placeholder="e.g., Capital One">
                    </div>

                    <div class="form-group">
                        <label>Account Number (optional):</label>
                        <input type="text" id="accountNumber" placeholder="Last 4 digits">
                    </div>

                    <div class="form-group">
                        <label>Date Opened:</label>
                        <input type="month" id="dateOpened">
                    </div>

                    <div class="form-group">
                        <label>Date of First Delinquency:</label>
                        <input type="month" id="dateDelinquent">
                    </div>

                    <div class="form-group">
                        <label>Dispute Reason:</label>
                        <textarea id="disputeReason" placeholder="Describe why this item is inaccurate or should be removed..."></textarea>
                    </div>

                    <button class="btn btn-accent" onclick="addManualItem()">Add Item & Generate Letter</button>
                </div>

                <!-- Strategies Tab -->
                <div id="strategiesTab" class="tab-content">
                    <div class="alert alert-warning">
                        <strong>‚ö° Fast-Removal Strategies</strong><br>
                        These advanced methods can remove negative items faster than standard disputes.
                    </div>

                    <div class="strategy-grid">
                        <div class="strategy-card" onclick="selectStrategy('factual')">
                            <span class="badge">BEST SUCCESS RATE</span>
                            <h4>üìä Factual Disputing</h4>
                            <p>Point out specific inaccuracies in reporting. Most effective method.</p>
                            <p><strong>Best for:</strong> Late payments, collections, any errors</p>
                        </div>

                        <div class="strategy-card" onclick="selectStrategy('605b')">
                            <span class="badge">4-DAY REMOVAL</span>
                            <h4>üî• Section 605B Identity Theft</h4>
                            <p>If you've been a victim of ID theft or data breaches, bureaus MUST remove items within 4 days.</p>
                            <p><strong>Best for:</strong> Identity theft victims, data breach affected</p>
                        </div>

                        <div class="strategy-card" onclick="selectStrategy('ferpa')">
                            <span class="badge">STUDENT LOANS</span>
                            <h4>üéì FERPA Violation</h4>
                            <p>Student loans with FERPA privacy violations can be disputed for cancellation.</p>
                            <p><strong>Best for:</strong> Student loans, education debt</p>
                        </div>

                        <div class="strategy-card" onclick="selectStrategy('metro2')">
                            <span class="badge">TECHNICAL ATTACK</span>
                            <h4>üí• Metro 2 Format Error</h4>
                            <p>Attack technical data format errors. Forces automatic deletion.</p>
                            <p><strong>Best for:</strong> Any account with reporting errors</p>
                        </div>

                        <div class="strategy-card" onclick="selectStrategy('obsolete')">
                            <span class="badge">AUTOMATIC</span>
                            <h4>üìÖ 7-Year Rule</h4>
                            <p>Items over 7 years old (10 for bankruptcy) must be removed by law.</p>
                            <p><strong>Best for:</strong> Old negative items, obsolete accounts</p>
                        </div>

                        <div class="strategy-card" onclick="selectStrategy('state')">
                            <span class="badge">STATE LAW</span>
                            <h4>‚öñÔ∏è State Law Violation</h4>
                            <p>Cite state-specific consumer protection laws (FCCPA, Rosenthal Act, etc.)</p>
                            <p><strong>Best for:</strong> All states, often stronger than federal laws</p>
                        </div>
                    </div>
                </div>

                <!-- Phantom Bureaus Tab -->
                <div id="phantomTab" class="tab-content">
                    <div class="alert alert-danger">
                        <strong>‚ö†Ô∏è CRITICAL STEP</strong><br>
                        These 3 "phantom" bureaus feed data to the Big 3. If you don't freeze them, removed items will just reappear!
                    </div>

                    <div class="bureau-grid">
                        <div class="bureau-card">
                            <h4>üìä SageStream (LexisNexis)</h4>
                            <p>Alternative credit scoring bureau</p>
                            <a href="https://forms.sagestreamllc.com/#/opt-self" target="_blank">‚û°Ô∏è Freeze Here</a>
                        </div>

                        <div class="bureau-card">
                            <h4>üéØ Innovis</h4>
                            <p>Fourth major credit bureau</p>
                            <a href="https://www.innovis.com/securityFreeze/index" target="_blank">‚û°Ô∏è Freeze Here</a>
                        </div>

                        <div class="bureau-card">
                            <h4>üìã LexisNexis</h4>
                            <p>Public records aggregator</p>
                            <a href="https://consumer.risk.lexisnexis.com/freeze" target="_blank">‚û°Ô∏è Freeze Here</a>
                        </div>
                    </div>

                    <div class="alert alert-info" style="margin-top: 20px;">
                        <strong>‚úÖ Complete Protection Checklist:</strong><br>
                        For complete credit protection, freeze ALL 6 bureaus:
                        <ul style="margin-top: 10px; margin-left: 20px;">
                            <li>Experian - experian.com/freeze</li>
                            <li>Equifax - equifax.com/personal/credit-report-services/credit-freeze</li>
                            <li>TransUnion - transunion.com/credit-freeze</li>
                            <li>SageStream (above)</li>
                            <li>Innovis (above)</li>
                            <li>LexisNexis (above)</li>
                        </ul>
                    </div>
                </div>

                <!-- Client Info Tab -->
                <div id="clientTab" class="tab-content">
                    <h3>üë§ Your Information</h3>
                    <p style="color: #666; margin-bottom: 20px;">Enter your details once and they will be included in all dispute letters automatically.</p>
                    
                    <div class="form-group">
                        <label>Full Name *</label>
                        <input type="text" id="clientFullName" placeholder="John Doe">
                    </div>
                    
                    <div class="form-group">
                        <label>Street Address *</label>
                        <input type="text" id="clientAddress" placeholder="123 Main Street">
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 2fr 1fr 1fr; gap: 15px;">
                        <div class="form-group">
                            <label>City *</label>
                            <input type="text" id="clientCity" placeholder="Miami">
                        </div>
                        <div class="form-group">
                            <label>State *</label>
                            <input type="text" id="clientState" placeholder="FL" maxlength="2">
                        </div>
                        <div class="form-group">
                            <label>ZIP *</label>
                            <input type="text" id="clientZip" placeholder="33101" maxlength="10">
                        </div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <div class="form-group">
                            <label>Phone *</label>
                            <input type="tel" id="clientPhone" placeholder="(305) 555-1234">
                        </div>
                        <div class="form-group">
                            <label>Email *</label>
                            <input type="email" id="clientEmail" placeholder="john@example.com">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>SSN Last 4 Digits *</label>
                        <input type="text" id="clientSSN" placeholder="1234" maxlength="4">
                    </div>
                    
                    <button class="btn btn-accent" onclick="saveClientInfo()">Save My Information</button>
                    
                    <div id="clientInfoSaved" class="alert alert-info hidden" style="margin-top: 20px;">
                        ‚úÖ Your information has been saved and will be included in all dispute letters.
                    </div>
                </div>

                <!-- Letters Tab -->
                <div id="lettersTab" class="tab-content">
                    <h3>Your Generated Dispute Letters</h3>
                    
                    <div id="lettersList">
                        <p style="color: #999; text-align: center; padding: 40px;">No letters generated yet. Upload a credit report or add items manually to generate letters.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // PASSWORD
        const ACCESS_CODE = 'S250502m!@#';
        let selectedItems = [];
        let generatedLetters = [];

        // Login Functions
        function checkLogin() {
            const input = document.getElementById('accessCode');
            const errorMsg = document.getElementById('loginError');
            
            if (input.value === ACCESS_CODE) {
                document.getElementById('loginScreen').classList.add('hidden');
                document.getElementById('mainApp').classList.remove('hidden');
                sessionStorage.setItem('analyzerLoggedIn', 'true');
            } else {
                errorMsg.style.display = 'block';
                input.value = '';
            }
        }

        function logout() {
            sessionStorage.removeItem('analyzerLoggedIn');
            document.getElementById('loginScreen').classList.remove('hidden');
            document.getElementById('mainApp').classList.add('hidden');
        }

        // Check if already logged in
        if (sessionStorage.getItem('analyzerLoggedIn') === 'true') {
            document.getElementById('loginScreen').classList.add('hidden');
            document.getElementById('mainApp').classList.remove('hidden');
        }

        // Enter key support
        document.getElementById('accessCode')?.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') checkLogin();
        });

        // Tab Switching
        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(tabName + 'Tab').classList.add('active');
        }

        // File Upload
        function handleFileSelect(event) {
            const file = event.target.files[0];
            if (!file) return;

            document.getElementById('fileName').textContent = file.name;
            document.getElementById('uploadStatus').classList.remove('hidden');

            // Simulate item detection
            setTimeout(() => {
                detectedItems = [
                    { type: 'Late Payment', creditor: 'Capital One', date: '2023-05', accountNumber: 'XXXX-1234' },
                    { type: 'Collection', creditor: 'ABC Collections', date: '2022-11', accountNumber: 'COL-9876' },
                    { type: 'Hard Inquiry', creditor: 'Auto Finance Co', date: '2023-08', accountNumber: 'INQ-4567' }
                ];

                let html = '';
                detectedItems.forEach((item, index) => {
                    html += `
                        <div class="item-row">
                            <input type="checkbox" id="item${index}" value="${index}">
                            <label for="item${index}">
                                <strong>${item.type}</strong> - ${item.creditor}
                                ${item.accountNumber ? '(Acct: ' + item.accountNumber + ')' : ''}
                                ${item.date ? '- Date: ' + item.date : ''}
                            </label>
                        </div>
                    `;
                });

                document.getElementById('itemsList').innerHTML = html;
                document.getElementById('extractedItems').classList.remove('hidden');
            }, 1000);
        }

        // Drag and drop
        const uploadArea = document.getElementById('uploadArea');
        uploadArea?.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.classList.add('dragover');
        });
        uploadArea?.addEventListener('dragleave', () => {
            uploadArea.classList.remove('dragover');
        });
        uploadArea?.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                document.getElementById('fileInput').files = files;
                handleFileSelect({ target: { files: files } });
            }
        });

        // Store items globally for reference
        let detectedItems = [];

        // Generate Letters from Items
        function generateLettersFromItems() {
            const checkboxes = document.querySelectorAll('#itemsList input:checked');
            if (checkboxes.length === 0) {
                alert('Please select at least one item to dispute.');
                return;
            }

            checkboxes.forEach((cb) => {
                const itemIndex = parseInt(cb.value);
                const item = detectedItems[itemIndex];
                if (item) {
                    generateLetter({
                        type: item.type,
                        creditor: item.creditor,
                        accountNumber: item.accountNumber || '',
                        dateOpened: item.dateOpened || item.date || '',
                        dateDelinquent: item.dateDelinquent || '',
                        reason: item.reason || '',
                        strategy: 'factual'
                    });
                }
            });

            switchTab('letters');
            updateLettersList();
        }

        // Manual Item Entry
        function addManualItem() {
            const item = {
                type: document.getElementById('itemType').value,
                creditor: document.getElementById('creditorName').value,
                accountNumber: document.getElementById('accountNumber').value,
                dateOpened: document.getElementById('dateOpened').value,
                dateDelinquent: document.getElementById('dateDelinquent').value,
                reason: document.getElementById('disputeReason').value,
                strategy: 'factual'
            };

            if (!item.creditor) {
                alert('Please enter creditor name');
                return;
            }

            generateLetter(item);
            switchTab('letters');
            updateLettersList();

            // Reset form
            document.getElementById('itemType').selectedIndex = 0;
            document.getElementById('creditorName').value = '';
            document.getElementById('accountNumber').value = '';
            document.getElementById('dateOpened').value = '';
            document.getElementById('dateDelinquent').value = '';
            document.getElementById('disputeReason').value = '';
        }

        // Strategy Selection
        function selectStrategy(strategy) {
            document.querySelectorAll('.strategy-card').forEach(c => c.classList.remove('selected'));
            event.currentTarget.classList.add('selected');
            
            // Store selected strategy
            sessionStorage.setItem('selectedStrategy', strategy);
        }

        // Generate Dispute Letter
        function generateLetter(item) {
            // Get client info
            let clientInfo = {
                fullName: '[YOUR NAME]',
                address: '[YOUR STREET ADDRESS]',
                city: '[CITY]',
                state: '[STATE]',
                zip: '[ZIP]',
                phone: '[PHONE]',
                email: '[EMAIL]',
                ssn: '[SSN LAST 4]'
            };

            const savedInfo = sessionStorage.getItem('clientInfo');
            if (savedInfo) {
                clientInfo = JSON.parse(savedInfo);
            }

            const date = new Date().toLocaleDateString('en-US', { 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            });

            // Build specific dispute reason based on item details
            let specificReason = item.reason || '';
            if (!specificReason) {
                specificReason = `I am disputing this ${item.type} account with ${item.creditor}. `;
                
                if (item.type === 'Late Payment') {
                    specificReason += `I dispute the reported late payment(s) as I have records showing payments were made on time. `;
                    specificReason += `The reported delinquency is inaccurate and damaging my credit score.`;
                } else if (item.type === 'Collection') {
                    specificReason += `I do not recognize this collection account and request validation of the debt. `;
                    specificReason += `If this debt is valid, I request proof of assignment from the original creditor.`;
                } else if (item.type === 'Charge-Off') {
                    specificReason += `I dispute the accuracy of this charge-off. `;
                    specificReason += `I request verification of the date of first delinquency and the accuracy of the reported balance.`;
                } else if (item.type === 'Hard Inquiry') {
                    specificReason += `I did not authorize this credit inquiry. `;
                    specificReason += `Please provide documentation showing my written authorization for this inquiry.`;
                } else {
                    specificReason += `This account contains inaccurate information. `;
                    specificReason += `I request that you verify all details with the original creditor and remove this item if it cannot be verified.`;
                }
            }

            const letter = `${clientInfo.fullName}
${clientInfo.address}
${clientInfo.city}, ${clientInfo.state} ${clientInfo.zip}
Phone: ${clientInfo.phone}
Email: ${clientInfo.email}
SSN: XXX-XX-${clientInfo.ssn}

${date}

Experian
P.O. Box 4500
Allen, TX 75013

RE: Formal Dispute of Inaccurate Information - FCRA ¬ß 611
Account: ${item.creditor}${item.accountNumber ? ' - Account #' + item.accountNumber : ''}

To Whom It May Concern:

I am writing to formally dispute inaccurate information appearing on my credit report. Under the Fair Credit Reporting Act (FCRA) ¬ß 611(a)(1)(A), you are required to conduct a reasonable investigation of this dispute within thirty (30) days of receipt.

CONSUMER INFORMATION:
Name: ${clientInfo.fullName}
Address: ${clientInfo.address}, ${clientInfo.city}, ${clientInfo.state} ${clientInfo.zip}
SSN: XXX-XX-${clientInfo.ssn}

ITEM DISPUTED:
- Creditor/Furnisher: ${item.creditor}
- Account Type: ${item.type}
- Account Number: ${item.accountNumber || 'Not Provided'}
- Date Opened: ${item.dateOpened || 'Unknown'}
${item.dateDelinquent ? '- Date of First Delinquency: ' + item.dateDelinquent + '\n' : ''}- Current Status: Reported as Negative/Adverse

SPECIFIC REASON FOR DISPUTE:
${specificReason}

REQUEST FOR INVESTIGATION:
I request that you conduct a complete investigation of this disputed item pursuant to 15 U.S.C. ¬ß 1681i(a)(1)(A). Specifically, I request that you:

1. Contact the furnisher (${item.creditor}) to verify the accuracy of this account
2. Provide me with the results of your investigation within 30 days
3. Forward all documentation supporting the continued reporting of this item
4. If the furnisher cannot verify this information, delete it from my credit report per FCRA ¬ß 611(a)(1)(B)

REMOVAL REQUEST:
If you cannot verify this information as accurate, complete, and verifiable, you are required by law to delete it from my credit report immediately. Pursuant to FCRA ¬ß 607(a), you must follow reasonable procedures to assure maximum possible accuracy of consumer reports.

I further request written confirmation of the deletion or correction of this item within 5 business days of completing your investigation.

AUTHORIZATION:
I authorize you to contact the creditor/furnisher listed above regarding this dispute. This is not a request for my credit file, but rather a formal dispute of specific information contained therein.

Thank you for your prompt attention to this matter.

Respectfully submitted,


_________________________________
${clientInfo.fullName}
Date: ${date}

Enclosures:
- Copy of Government-Issued Photo ID
- Copy of Social Security Card (showing last 4 digits: ${clientInfo.ssn})
- Copy of Recent Utility Bill (proving current address)
- ${item.type === 'Late Payment' || item.type === 'Collection' || item.type === 'Charge-Off' ? '- Any supporting documentation showing payment records or evidence of inaccuracy\n' : ''}

CC: Consumer Financial Protection Bureau (if unresolved)
            `.trim();

            generatedLetters.push({
                creditor: item.creditor,
                type: item.type,
                content: letter,
                date: new Date().toISOString()
            });
        }

        // Update Letters List
        function updateLettersList() {
            const container = document.getElementById('lettersList');
            
            if (generatedLetters.length === 0) {
                container.innerHTML = '<p style="color: #999; text-align: center; padding: 40px;">No letters generated yet.</p>';
                return;
            }

            let html = '';
            generatedLetters.forEach((letter, index) => {
                html += `
                    <div style="margin-bottom: 30px; border: 1px solid #ddd; border-radius: 8px; overflow: hidden;">
                        <div style="background: #1e3c72; color: white; padding: 15px; display: flex; justify-content: space-between; align-items: center;">
                            <span><strong>${letter.creditor}</strong> - ${letter.type}</span>
                            <div>
                                <button class="btn" onclick="downloadPDF(${index})" style="width: auto; padding: 8px 16px; margin-right: 10px;">üìÑ PDF</button>
                                <button class="btn" onclick="downloadTXT(${index})" style="width: auto; padding: 8px 16px;">üìù TXT</button>
                            </div>
                        </div>
                        <div class="letter-output">${letter.content.replace(/\n/g, '<br>')}</div>
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        // Download as TXT
        function downloadTXT(index) {
            const letter = generatedLetters[index];
            const blob = new Blob([letter.content], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `dispute-letter-${letter.creditor.replace(/\s+/g, '-').toLowerCase()}-${Date.now()}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // Download as PDF
        function downloadPDF(index) {
            const letter = generatedLetters[index];
            const { jsPDF } = window.jspdf;
            
            const doc = new jsPDF({
                margin: 25,
                unit: 'mm',
                format: 'letter'
            });

            // Set font
            doc.setFont('times', 'normal');
            doc.setFontSize(11);

            // Parse letter content and add to PDF
            const lines = letter.content.split('\n');
            let y = 20;
            const lineHeight = 5;
            const margin = 25;
            const maxWidth = 170;

            lines.forEach(line => {
                if (y > 270) {
                    doc.addPage();
                    y = 20;
                }

                // Check if line is a header or important
                if (line.startsWith('RE:') || line.startsWith('ITEM DISPUTED') || line.startsWith('SPECIFIC REASON') || line.startsWith('REQUEST FOR') || line.startsWith('REMOVAL REQUEST')) {
                    doc.setFont('times', 'bold');
                } else {
                    doc.setFont('times', 'normal');
                }

                // Handle long lines
                const textLines = doc.splitTextToSize(line || ' ', maxWidth);
                textLines.forEach(textLine => {
                    doc.text(textLine, margin, y);
                    y += lineHeight;
                });

                // Add extra spacing after sections
                if (line === '' || line.startsWith('RE:') || line.startsWith('ITEM DISPUTED') || line.startsWith('SPECIFIC REASON') || line.startsWith('REQUEST FOR') || line.startsWith('REMOVAL REQUEST')) {
                    y += 2;
                }
            });

            // Save PDF
            doc.save(`dispute-letter-${letter.creditor.replace(/\s+/g, '-').toLowerCase()}-${Date.now()}.pdf`);
        }

        // Client Info Functions
        function saveClientInfo() {
            const clientInfo = {
                fullName: document.getElementById('clientFullName').value,
                address: document.getElementById('clientAddress').value,
                city: document.getElementById('clientCity').value,
                state: document.getElementById('clientState').value,
                zip: document.getElementById('clientZip').value,
                phone: document.getElementById('clientPhone').value,
                email: document.getElementById('clientEmail').value,
                ssn: document.getElementById('clientSSN').value
            };

            // Validate required fields
            if (!clientInfo.fullName || !clientInfo.address || !clientInfo.city || !clientInfo.state || !clientInfo.zip) {
                alert('Please fill in all required fields (marked with *).');
                return;
            }

            sessionStorage.setItem('clientInfo', JSON.stringify(clientInfo));
            document.getElementById('clientInfoSaved').classList.remove('hidden');
        }

        function loadClientInfo() {
            const saved = sessionStorage.getItem('clientInfo');
            if (saved) {
                const clientInfo = JSON.parse(saved);
                document.getElementById('clientFullName').value = clientInfo.fullName || '';
                document.getElementById('clientAddress').value = clientInfo.address || '';
                document.getElementById('clientCity').value = clientInfo.city || '';
                document.getElementById('clientState').value = clientInfo.state || '';
                document.getElementById('clientZip').value = clientInfo.zip || '';
                document.getElementById('clientPhone').value = clientInfo.phone || '';
                document.getElementById('clientEmail').value = clientInfo.email || '';
                document.getElementById('clientSSN').value = clientInfo.ssn || '';
                
                if (clientInfo.fullName) {
                    document.getElementById('clientInfoSaved').classList.remove('hidden');
                }
            }
        }

        // Load client info on page load
        if (sessionStorage.getItem('analyzerLoggedIn') === 'true') {
            loadClientInfo();
        }
    </script>
</body>
</html>