<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Credit Report Analyzer - Fresh Start Credit</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tesseract.js/4.1.1/tesseract.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        .header {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            padding: 30px;
            text-align: center;
            position: relative;
        }
        .header h1 { font-size: 28px; margin-bottom: 10px; }
        .header p { opacity: 0.9; }
        .content { padding: 30px; }
        
        /* Login Screen */
        .login-screen {
            text-align: center;
            padding: 60px 30px;
        }
        .login-screen h2 {
            color: #1e3c72;
            margin-bottom: 20px;
            font-size: 24px;
        }
        .login-screen p {
            color: #666;
            margin-bottom: 30px;
        }
        .password-input {
            max-width: 400px;
            margin: 0 auto;
        }
        .password-input input {
            width: 100%;
            padding: 15px;
            font-size: 18px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            text-align: center;
            letter-spacing: 3px;
        }
        .password-input input:focus {
            outline: none;
            border-color: #1e3c72;
        }
        .error-msg {
            color: #dc3545;
            margin-top: 15px;
            display: none;
        }
        
        /* Upload Section */
        .upload-area {
            border: 3px dashed #1e3c72;
            border-radius: 15px;
            padding: 50px 30px;
            text-align: center;
            background: #f8f9fa;
            cursor: pointer;
            transition: all 0.3s;
            margin-bottom: 30px;
        }
        .upload-area:hover {
            background: #e9ecef;
            border-color: #2a5298;
        }
        .upload-area.dragover {
            background: #d1ecf1;
            border-color: #0c5460;
        }
        .upload-area .icon {
            font-size: 48px;
            margin-bottom: 15px;
        }
        .upload-area h3 {
            color: #1e3c72;
            margin-bottom: 10px;
        }
        .upload-area p {
            color: #666;
            font-size: 14px;
        }
        #fileInput { display: none; }
        
        /* Progress Bar */
        .progress-container {
            display: none;
            margin: 20px 0;
        }
        .progress-bar {
            height: 30px;
            background: #e9ecef;
            border-radius: 15px;
            overflow: hidden;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            width: 0%;
            transition: width 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }
        .progress-text {
            text-align: center;
            margin-top: 10px;
            color: #666;
        }
        
        /* Analysis Results Dashboard */
        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .dashboard-card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            text-align: center;
            border-top: 4px solid #1e3c72;
        }
        .dashboard-card.success { border-top-color: #28a745; }
        .dashboard-card.warning { border-top-color: #ffc107; }
        .dashboard-card.danger { border-top-color: #dc3545; }
        .dashboard-card.info { border-top-color: #17a2b8; }
        .dashboard-number {
            font-size: 36px;
            font-weight: bold;
            color: #1e3c72;
            margin-bottom: 5px;
        }
        .dashboard-label {
            color: #666;
            font-size: 14px;
        }
        .dashboard-card.success .dashboard-number { color: #28a745; }
        .dashboard-card.warning .dashboard-number { color: #ffc107; }
        .dashboard-card.danger .dashboard-number { color: #dc3545; }
        
        /* Section styling */
        .section { margin-bottom: 30px; }
        .section h2 {
            color: #1e3c72;
            margin-bottom: 20px;
            font-size: 22px;
            border-bottom: 3px solid #e0e0e0;
            padding-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        /* Form styling */
        .form-group {
            margin-bottom: 20px;
        }
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }
        input, select, textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.3s;
        }
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #1e3c72;
        }
        input.auto-filled, textarea.auto-filled {
            background: #e8f5e9;
            border-color: #4caf50;
        }
        .auto-fill-indicator {
            font-size: 12px;
            color: #4caf50;
            margin-top: 5px;
        }
        textarea { resize: vertical; min-height: 100px; }
        
        /* Discrepancy Cards */
        .discrepancy-card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
            border-left: 5px solid #dc3545;
        }
        .discrepancy-card.warning { border-left-color: #ffc107; }
        .discrepancy-card.info { border-left-color: #17a2b8; }
        .discrepancy-card.success { border-left-color: #28a745; }
        
        .discrepancy-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        .discrepancy-title {
            font-size: 18px;
            font-weight: bold;
            color: #333;
        }
        .discrepancy-severity {
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            text-transform: uppercase;
        }
        .severity-high {
            background: #ffebee;
            color: #c62828;
        }
        .severity-medium {
            background: #fff3e0;
            color: #ef6c00;
        }
        .severity-low {
            background: #e3f2fd;
            color: #1565c0;
        }
        
        .discrepancy-content {
            margin-bottom: 20px;
        }
        .discrepancy-content p {
            color: #555;
            line-height: 1.6;
            margin-bottom: 10px;
        }
        
        .dispute-strategy {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            margin-top: 15px;
        }
        .dispute-strategy h4 {
            color: #1e3c72;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .strategy-step {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
            padding: 15px;
            background: white;
            border-radius: 8px;
        }
        .step-number {
            width: 30px;
            height: 30px;
            background: #1e3c72;
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            flex-shrink: 0;
        }
        .step-content h5 {
            color: #333;
            margin-bottom: 5px;
        }
        .step-content p {
            color: #666;
            font-size: 14px;
            margin: 0;
        }
        
        /* Checkbox styling */
        .checkbox-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 12px;
        }
        .checkbox-item {
            display: flex;
            align-items: flex-start;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s;
            border: 2px solid transparent;
        }
        .checkbox-item:hover { 
            background: #e9ecef; 
        }
        .checkbox-item.selected {
            background: #e3f2fd;
            border-color: #1e3c72;
        }
        .checkbox-item input {
            width: auto;
            margin-right: 12px;
            margin-top: 3px;
        }
        .checkbox-item .info {
            flex: 1;
        }
        .checkbox-item .info strong {
            display: block;
            color: #333;
            margin-bottom: 5px;
            font-size: 15px;
        }
        .checkbox-item .info small {
            color: #666;
            font-size: 13px;
        }
        
        /* Buttons */
        .btn {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 18px;
            font-weight: 600;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-block;
            margin: 10px 5px;
        }
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(30, 60, 114, 0.4);
        }
        .btn-secondary {
            background: #6c757d;
        }
        .btn-success {
            background: #28a745;
        }
        .btn-danger {
            background: #dc3545;
        }
        .btn-warning {
            background: #ffc107;
            color: #333;
        }
        .btn-group {
            text-align: center;
            margin-top: 30px;
        }
        
        /* Results Section */
        .results {
            display: none;
            background: #f8f9fa;
            border-radius: 15px;
            padding: 30px;
            margin-top: 30px;
        }
        
        /* Letter Preview */
        .letter-preview {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            padding: 40px;
            margin-top: 20px;
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
            max-height: 600px;
            overflow-y: auto;
            font-size: 14px;
            line-height: 1.8;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
        }
        
        /* Tabs */
        .tabs {
            display: flex;
            border-bottom: 3px solid #e0e0e0;
            margin-bottom: 30px;
            gap: 5px;
        }
        .tab {
            padding: 15px 30px;
            cursor: pointer;
            border-bottom: 4px solid transparent;
            font-weight: 600;
            color: #666;
            transition: all 0.3s;
            border-radius: 8px 8px 0 0;
        }
        .tab:hover {
            color: #1e3c72;
            background: #f8f9fa;
        }
        .tab.active {
            color: #1e3c72;
            border-bottom-color: #1e3c72;
            background: #e3f2fd;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        
        /* Logout Button */
        .logout-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255,255,255,0.2);
            color: white;
            border: 1px solid rgba(255,255,255,0.3);
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }
        .logout-btn:hover {
            background: rgba(255,255,255,0.3);
        }
        
        /* Extraction Preview */
        .extraction-preview {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .extraction-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        .extracted-field {
            display: flex;
            align-items: center;
            padding: 10px;
            margin-bottom: 8px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        .extracted-field label {
            min-width: 150px;
            margin: 0;
            font-weight: 600;
            color: #555;
        }
        .extracted-field .value {
            color: #333;
            flex: 1;
        }
        .extracted-field .confidence {
            padding: 4px 10px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
        }
        .confidence-high { background: #d4edda; color: #155724; }
        .confidence-medium { background: #fff3cd; color: #856404; }
        .confidence-low { background: #f8d7da; color: #721c24; }
        
        /* Why This Works Box */
        .why-box {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 12px;
            padding: 25px;
            margin: 20px 0;
        }
        .why-box h4 {
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .why-box ul {
            list-style: none;
            padding: 0;
        }
        .why-box li {
            padding: 8px 0;
            padding-left: 25px;
            position: relative;
        }
        .why-box li:before {
            content: "‚úì";
            position: absolute;
            left: 0;
            font-weight: bold;
        }
        
        /* Legal Reference Box */
        .legal-box {
            background: #e8eaf6;
            border-left: 4px solid #3f51b5;
            padding: 20px;
            border-radius: 0 8px 8px 0;
            margin: 15px 0;
        }
        .legal-box h5 {
            color: #3f51b5;
            margin-bottom: 10px;
        }
        .legal-box p {
            color: #444;
            font-size: 14px;
            line-height: 1.6;
        }
        
        .hidden { display: none !important; }
        
        /* Success rate badge */
        .success-badge {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: bold;
        }
        .success-high {
            background: #d4edda;
            color: #155724;
        }
        .success-medium {
            background: #fff3cd;
            color: #856404;
        }
        .success-low {
            background: #f8d7da;
            color: #721c24;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Login Screen -->
        <div id="loginScreen" class="login-screen">
            <h2>üîí Dispute Portal</h2>
            <p>Enter the access code to analyze credit reports</p>
            <div class="password-input">
                <input type="password" id="accessCode" placeholder="Enter Access Code" maxlength="20">
                <button class="btn" onclick="checkLogin()" style="margin-top: 20px;">Access Portal</button>
            </div>
            <p id="loginError" class="error-msg">Invalid access code. Please try again.</p>
            <p style="margin-top: 30px; color: #999; font-size: 12px;">Need access? Call (305) 747-3973</p>
        </div>

        <!-- Main App -->
        <div id="mainApp" class="hidden">
            <div class="header">
                <button class="logout-btn" onclick="logout()">üö™ Logout</button>
                <h1>ü§ñ AI Credit Report Analyzer</h1>
                <p>Auto-detect errors, find discrepancies, generate dispute strategies</p>
            </div>
            
            <div class="content">
                <!-- Tabs -->
                <div class="tabs">
                    <div class="tab active" onclick="switchTab('upload')">üì§ Upload Report</div>
                    <div class="tab" onclick="switchTab('manual')">‚úèÔ∏è Manual Entry</div>
                </div>

                <!-- Upload Tab -->
                <div id="uploadTab" class="tab-content active">
                    <div class="upload-area" id="uploadArea" onclick="document.getElementById('fileInput').click()">
                        <div class="icon">üìÑ</div>
                        <h3>Upload Credit Report</h3>
                        <p>Click or drag PDF/Image here</p>
                        <p style="margin-top: 15px; font-size: 12px; color: #999;">PDF, JPG, PNG, HEIC (Max 10MB)</p>
                    </div>
                    
                    <input type="file" id="fileInput" accept=".pdf,.jpg,.jpeg,.png,.heic" onchange="handleFileUpload(event)">
                    
                    <div id="progressContainer" class="progress-container">
                        <div class="progress-bar">
                            <div id="progressFill" class="progress-fill">0%</div>
                        </div>
                        <p id="progressText" class="progress-text">Uploading...</p>
                    </div>
                    
                    <!-- Extracted Data Preview -->
                    <div id="extractedDataSection" class="extraction-preview hidden">
                        <div class="extraction-header">
                            <h3>üîç Auto-Extracted Data</h3>
                            <span style="color: #4caf50; font-weight: bold;">‚úì AI Analysis Complete</span>
                        </div>
                        <div id="extractedFields"></div>
                        
                        <div style="margin-top: 20px; padding: 15px; background: #e8f5e9; border-radius: 8px;">
                            <p style="color: #2e7d32; margin: 0;">
                                <strong>‚úì Auto-fill complete!</strong> The form below has been populated with data from your credit report. 
                                Please review and correct any errors before generating dispute letters.
                            </p>
                        </div>
                    </div>
                    
                    <div id="analyzeButtonSection" class="hidden" style="text-align: center;">
                        <button class="btn" onclick="analyzeUploadedReport()">üöÄ Find Discrepancies & Generate Strategy</button>
                    </div>
                </div>

                <!-- Manual Entry Tab -->
                <div id="manualTab" class="tab-content">
                    <form id="analyzerForm" onsubmit="event.preventDefault(); analyzeForm();">
                        <!-- Client Info -->
                        <div class="section">
                            <h2>üë§ Client Information</h2>
                            
                            <div class="form-group">
                                <label>Full Name *</label>
                                <input type="text" id="clientName" required placeholder="John Smith">
                            </div>
                            
                            <div class="form-group">
                                <label>Email *</label>
                                <input type="email" id="clientEmail" required placeholder="john@example.com">
                            </div>
                            
                            <div class="form-group">
                                <label>Address *</label>
                                <textarea id="clientAddress" required placeholder="123 Main St, Miami, FL 33101"></textarea>
                            </div>
                            
                            <div class="form-group">
                                <label>SSN Last 4 *</label>
                                <input type="text" id="ssnLast4" maxlength="4" required placeholder="1234">
                            </div>
                        </div>

                        <!-- Credit Report Items -->
                        <div class="section">
                            <h2>‚ö†Ô∏è Negative Items on Report</h2>
                            
                            <div class="checkbox-group" id="negativeItemsContainer">
                                <label class="checkbox-item" data-item="late_payment">
                                    <input type="checkbox" name="negativeItems" value="late_payment">
                                    <div class="info">
                                        <strong>Late Payments <span class="success-badge success-medium">75% Success</span></strong>
                                        <small>30/60/90 day late marks. Dispute if dates are wrong or you have proof of on-time payment.</small>
                                    </div>
                                </label>
                                
                                <label class="checkbox-item" data-item="collections">
                                    <input type="checkbox" name="negativeItems" value="collections">
                                    <div class="info">
                                        <strong>Collections Accounts <span class="success-badge success-high">85% Success</span></strong>
                                        <small>Demand debt validation. Many collectors lack proper documentation.</small>
                                    </div>
                                </label>
                                
                                <label class="checkbox-item" data-item="charge_off">
                                    <input type="checkbox" name="negativeItems" value="charge_off">
                                    <div class="info">
                                        <strong>Charge-Offs <span class="success-badge success-medium">65% Success</span></strong>
                                        <small>Dispute accuracy of reporting dates and amounts. Check for re-aging.</small>
                                    </div>
                                </label>
                                
                                <label class="checkbox-item" data-item="hard_inquiry">
                                    <input type="checkbox" name="negativeItems" value="hard_inquiry">
                                    <div class="info">
                                        <strong>Hard Inquiries <span class="success-badge success-high">90% Success</span></strong>
                                        <small>Unauthorized inquiries are easy to remove. You have the right to know who accessed your credit.</small>
                                    </div>
                                </label>
                                
                                <label class="checkbox-item" data-item="duplicate_account">
                                    <input type="checkbox" name="negativeItems" value="duplicate_account">
                                    <div class="info">
                                        <strong>Duplicate Accounts <span class="success-badge success-high">95% Success</span></strong>
                                        <small>Same debt reported multiple times. Automatic violation - must be removed.</small>
                                    </div>
                                </label>
                                
                                <label class="checkbox-item" data-item="incorrect_balance">
                                    <input type="checkbox" name="negativeItems" value="incorrect_balance">
                                    <div class="info">
                                        <strong>Incorrect Balances <span class="success-badge success-medium">70% Success</span></strong>
                                        <small>Balance doesn't match your records or shows paid debt as owed.</small>
                                    </div>
                                </label>
                                
                                <label class="checkbox-item" data-item="unauthorized_account">
                                    <input type="checkbox" name="negativeItems" value="unauthorized_account">
                                    <div class="info">
                                        <strong>Unauthorized/Fraudulent Accounts <span class="success-badge success-high">90% Success</span></strong>
                                        <small>Identity theft or accounts you never opened. Fast removal with proper documentation.</small>
                                    </div>
                                </label>
                            </div>
                        </div>

                        <!-- Dispute Reasons -->
                        <div class="section">
                            <h2>üîç Why Are These Items Wrong?</h2>
                            
                            <div class="checkbox-group">
                                <label class="checkbox-item">
                                    <input type="checkbox" name="errors" value="not_mine">
                                    <div class="info">
                                        <strong>üî¥ This is NOT my account / Identity Theft</strong>
                                        <small>I never opened this account. Possible identity theft or mixed credit files.</small>
                                    </div>
                                </label>
                                
                                <label class="checkbox-item">
                                    <input type="checkbox" name="errors" value="date_inaccurate">
                                    <div class="info">
                                        <strong>üü° Dates are wrong / Account re-aged</strong>
                                        <small>Dates don't match my records OR creditor changed dates to keep item on report longer.</small>
                                    </div>
                                </label>
                                
                                <label class="checkbox-item">
                                    <input type="checkbox" name="errors" value="paid_still_reporting">
                                    <div class="info">
                                        <strong>üü° Paid/Settled but still showing negative</strong>
                                        <small>Account was paid or settled but still reporting as unpaid or negative.</small>
                                    </div>
                                </label>
                                
                                <label class="checkbox-item">
                                    <input type="checkbox" name="errors" value="duplicate_entry">
                                    <div class="info">
                                        <strong>üü¢ Same account listed multiple times</strong>
                                        <small>Original creditor AND collection agency reporting same debt. Illegal double-reporting.</small>
                                    </div>
                                </label>
                                
                                <label class="checkbox-item">
                                    <input type="checkbox" name="errors" value="old_account">
                                    <div class="info">
                                        <strong>üü¢ Account is older than 7 years</strong>
                                        <small>Negative items must be removed after 7 years (10 for bankruptcy) from first delinquency.</small>
                                    </div>
                                </label>
                                
                                <label class="checkbox-item">
                                    <input type="checkbox" name="errors" value="incorrect_balance">
                                    <div class="info">
                                        <strong>üü° Balance or credit limit is wrong</strong>
                                        <small>Amount owed is incorrect, credit limit is wrong, or utilization is miscalculated.</small>
                                    </div>
                                </label>
                                
                                <label class="checkbox-item">
                                    <input type="checkbox" name="errors" value="unauthorized_inquiry">
                                    <div class="info">
                                        <strong>üü¢ I didn't authorize this credit inquiry</strong>
                                        <small>Hard inquiry without my permission. I have no record of applying for credit.</small>
                                    </div>
                                </label>
                            </div>
                        </div>

                        <!-- Account Details -->
                        <div class="section">
                            <h2>üè¢ Account Details</h2>
                            
                            <div class="form-group">
                                <label>Creditor Name *</label>
                                <input type="text" id="creditorName" required placeholder="e.g., Chase Bank, Portfolio Recovery">
                            </div>
                            
                            <div class="form-group">
                                <label>Account Number</label>
                                <input type="text" id="accountNumber" placeholder="XXXX1234 or 'Not Visible'">
                            </div>
                            
                            <div class="form-group">
                                <label>Date Opened</label>
                                <input type="month" id="dateOpened">
                                <p class="auto-fill-indicator" id="dateOpenedIndicator"></p>
                            </div>
                            
                            <div class="form-group">
                                <label>Date of First Delinquency</label>
                                <input type="month" id="dateDelinquent">
                                <p class="auto-fill-indicator" id="dateDelinquentIndicator"></p>
                            </div>
                            
                            <div class="form-group">
                                <label>Additional Notes / Evidence</label>
                                <textarea id="additionalNotes" placeholder="Describe what you found wrong and any evidence you have..."></textarea>
                            </div>
                        </div>

                        <!-- Credit Bureaus -->
                        <div class="section">
                            <h2>üìä Select Credit Bureaus to Dispute</h2>
                            
                            <div class="checkbox-group">
                                <label class="checkbox-item">
                                    <input type="checkbox" name="bureaus" value="experian" checked>
                                    <div class="info">
                                        <strong>Experian</strong>
                                        <small>P.O. Box 4500, Allen, TX 75013 | experian.com/dispute</small>
                                    </div>
                                </label>
                                
                                <label class="checkbox-item">
                                    <input type="checkbox" name="bureaus" value="equifax" checked>
                                    <div class="info">
                                        <strong>Equifax</strong>
                                        <small>P.O. Box 740256, Atlanta, GA 30374 | equifax.com/personal/credit-report-services/credit-dispute/</small>
                                    </div>
                                </label>
                                
                                <label class="checkbox-item">
                                    <input type="checkbox" name="bureaus" value="transunion" checked>
                                    <div class="info">
                                        <strong>TransUnion</strong>
                                        <small>P.O. Box 2000, Chester, PA 19016 | transunion.com/credit-disputes</small>
                                    </div>
                                </label>
                            </div>
                        </div>

                        <div class="btn-group">
                            <button type="submit" class="btn">üöÄ Analyze & Generate Dispute Strategy</button>
                        </div>
                    </form>
                </div>

                <!-- Results Section -->
                <div id="results" class="results">
                    <!-- Dashboard Stats -->
                    <div class="dashboard">
                        <div class="dashboard-card danger">
                            <div class="dashboard-number" id="totalDiscrepancies">0</div>
                            <div class="dashboard-label">Discrepancies Found</div>
                        </div>
                        
                        <div class="dashboard-card warning">
                            <div class="dashboard-number" id="highPriorityItems">0</div>
                            <div class="dashboard-label">High Priority</div>
                        </div>
                        
                        <div class="dashboard-card info">
                            <div class="dashboard-number" id="totalBureaus">0</div>
                            <div class="dashboard-label">Bureaus to Contact</div>
                        </div>
                        
                        <div class="dashboard-card success">
                            <div class="dashboard-number" id="estimatedPoints">+0</div>
                            <div class="dashboard-label">Est. Score Increase</div>
                        </div>
                    </div>

                    <!-- Discrepancy Analysis -->
                    <div id="discrepancyAnalysis"></div>

                    <!-- Dispute Letters -->
                    <h2 style="margin-top: 40px;">üìù Ready-to-Mail Dispute Letters</h2>
                    
                    <p style="color: #666; margin-bottom: 20px;">
                        These letters are customized for each bureau. Print, sign, and mail with copies of your ID and proof of address.
                    </p>
                    
                    <div id="letters"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Password protection
        const ACCESS_CODE = 'S250502m!@#';
        
        function checkLogin() {
            const enteredCode = document.getElementById('accessCode').value;
            if (enteredCode === ACCESS_CODE) {
                sessionStorage.setItem('creditAnalyzerLoggedIn', 'true');
                document.getElementById('loginScreen').classList.add('hidden');
                document.getElementById('mainApp').classList.remove('hidden');
            } else {
                document.getElementById('loginError').style.display = 'block';
            }
        }
        
        function logout() {
            sessionStorage.removeItem('creditAnalyzerLoggedIn');
            location.reload();
        }
        
        if (sessionStorage.getItem('creditAnalyzerLoggedIn') === 'true') {
            document.getElementById('loginScreen').classList.add('hidden');
            document.getElementById('mainApp').classList.remove('hidden');
        }
        
        document.getElementById('accessCode')?.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') checkLogin();
        });
        
        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');
            document.getElementById(tabName + 'Tab').classList.add('active');
        }
        
        // File Upload Handling
        let extractedText = '';
        let extractedData = {};
        
        const uploadArea = document.getElementById('uploadArea');
        uploadArea.addEventListener('dragover', (e) => { e.preventDefault(); uploadArea.classList.add('dragover'); });
        uploadArea.addEventListener('dragleave', () => uploadArea.classList.remove('dragover'));
        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
            if (e.dataTransfer.files.length) {
                document.getElementById('fileInput').files = e.dataTransfer.files;
                handleFileUpload({ target: { files: e.dataTransfer.files } });
            }
        });
        
        function handleFileUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            if (file.size > 10 * 1024 * 1024) {
                alert('File too large. Maximum size is 10MB.');
                return;
            }
            
            const progressContainer = document.getElementById('progressContainer');
            const progressFill = document.getElementById('progressFill');
            const progressText = document.getElementById('progressText');
            
            progressContainer.style.display = 'block';
            progressFill.style.width = '0%';
            progressFill.textContent = '0%';
            progressText.textContent = 'Starting analysis...';
            
            if (file.type === 'application/pdf') {
                extractFromPDF(file, progressFill, progressText);
            } else if (file.type.startsWith('image/')) {
                extractFromImage(file, progressFill, progressText);
            }
        }
        
        async function extractFromPDF(file, progressFill, progressText) {
            const arrayBuffer = await file.arrayBuffer();
            const pdf = await pdfjsLib.getDocument({ data: arrayBuffer }).promise;
            
            let fullText = '';
            for (let i = 1; i <= pdf.numPages; i++) {
                progressText.textContent = `Reading page ${i} of ${pdf.numPages}...`;
                progressFill.style.width = Math.round((i / pdf.numPages) * 50) + '%';
                progressFill.textContent = progressFill.style.width;
                
                const page = await pdf.getPage(i);
                const textContent = await page.getTextContent();
                fullText += textContent.items.map(item => item.str).join(' ') + '\n';
            }
            
            extractedText = fullText;
            processExtractedData(progressFill, progressText);
        }
        
        async function extractFromImage(file, progressFill, progressText) {
            progressText.textContent = 'Analyzing image with AI...';
            progressFill.style.width = '30%';
            
            const { createWorker } = Tesseract;
            const worker = await createWorker('eng');
            
            progressFill.style.width = '60%';
            progressText.textContent = 'Reading text...';
            
            const { data: { text } } = await worker.recognize(URL.createObjectURL(file));
            await worker.terminate();
            
            extractedText = text;
            processExtractedData(progressFill, progressText);
        }
        
        function processExtractedData(progressFill, progressText) {
            progressText.textContent = 'Finding discrepancies...';
            progressFill.style.width = '80%';
            
            // Extract client info
            extractedData = extractClientInfo(extractedText);
            
            // Detect negative items
            extractedData.negativeItems = detectNegativeItems(extractedText);
            
            // Find discrepancies
            extractedData.discrepancies = findDiscrepancies(extractedText);
            
            progressFill.style.width = '100%';
            progressFill.textContent = '100%';
            progressText.textContent = '‚úÖ Analysis complete! Review the data below.';
            
            // Show extracted data
            displayExtractedData();
            
            // Auto-fill form
            autoFillForm();
            
            document.getElementById('analyzeButtonSection').classList.remove('hidden');
        }
        
        function extractClientInfo(text) {
            const data = {};
            const lines = text.split('\n');
            
            // Name patterns
            const nameMatch = text.match(/(?:name|consumer|reported for)[:\s]+([A-Z][a-z]+\s+[A-Z][a-z]+)/i);
            if (nameMatch) data.name = nameMatch[1];
            
            // Address patterns
            const addressMatch = text.match(/(\d+\s+[^,]+,\s*[^,]+,\s*[A-Z]{2}\s*\d{5}(-\d{4})?)/);
            if (addressMatch) data.address = addressMatch[1];
            
            // SSN patterns
            const ssnMatch = text.match(/(?:SSN|social)[:\s]+(\d{3}-?\d{2}-?\d{4}|XXX-XX-(\d{4}))/i);
            if (ssnMatch) data.ssn = ssnMatch[2] || ssnMatch[1].slice(-4);
            
            // DOB patterns
            const dobMatch = text.match(/(?:DOB|birth)[:\s]+(\d{2}\/\d{2}\/\d{4}|\d{4}-\d{2}-\d{2})/i);
            if (dobMatch) data.dob = dobMatch[1];
            
            return data;
        }
        
        function detectNegativeItems(text) {
            const items = [];
            const lowerText = text.toLowerCase();
            
            const patterns = {
                late_payment: /(30|60|90|120)\s*days?\s*late|past\s*due|delinquent|payment\s*history/i,
                collections: /collection|collected|debt\s*collector|placed\s*for\s*collection|assigned\s*to/i,
                charge_off: /charge[\s-]*off|charged\s*off|profit\s*and\s*loss|written?\s*off/i,
                repossession: /repossession|repos|repo|repossessed/i,
                foreclosure: /foreclos|foreclosed|in\s*foreclosure/i,
                bankruptcy: /bankruptcy|chapter\s*(7|13)|discharged|filed\s*bankruptcy/i,
                tax_lien: /tax\s*lien|federal\s*tax\s*lien|state\s*tax\s*lien/i,
                judgment: /judgment|court\s*judgment|civil\s*judgment/i,
                hard_inquiry: /hard\s*inquiry|credit\s*inquiry|inquiry\s*date/i,
                duplicate_account: /duplicate|same\s*account|multiple\s*listings/i
            };
            
            for (const [type, pattern] of Object.entries(patterns)) {
                if (pattern.test(lowerText)) {
                    items.push(type);
                }
            }
            
            return items;
        }
        
        function findDiscrepancies(text) {
            const discrepancies = [];
            const lines = text.split('\n');
            
            // Check for date discrepancies
            const datePattern = /(\d{2}\/\d{2}\/\d{4}|\d{4}-\d{2}-\d{2})/g;
            const dates = text.match(datePattern) || [];
            
            if (dates.length > 2) {
                // Check for accounts with different dates across sections
                discrepancies.push({
                    type: 'date_mismatch',
                    severity: 'high',
                    title: 'Date Discrepancy Detected',
                    description: 'Multiple dates found for the same account. This could indicate re-aging or inaccurate reporting.',
                    strategy: 'Dispute based on FCRA requirement for accurate date reporting. Demand verification of the correct date of first delinquency.'
                });
            }
            
            // Check for balance discrepancies
            const balanceMatches = text.match(/balance[:\s]+\$?([\d,]+\.?\d{0,2})/gi) || [];
            if (balanceMatches.length > 1) {
                const balances = balanceMatches.map(b => parseFloat(b.replace(/[^\d.]/g, '')));
                if (balances[0] !== balances[1]) {
                    discrepancies.push({
                        type: 'balance_mismatch',
                        severity: 'medium',
                        title: 'Balance Inconsistency',
                        description: `Different balances reported: $${balances[0]} vs $${balances[1]}`,
                        strategy: 'Dispute the accuracy of the balance. Request debt validation and documentation of the correct amount owed.'
                    });
                }
            }
            
            // Check for duplicate reporting
            const accountMatches = text.match(/(?:account|acct)[:\s#]+([\d\-X]+)/gi) || [];
            const uniqueAccounts = [...new Set(accountMatches)];
            if (accountMatches.length > uniqueAccounts.length) {
                discrepancies.push({
                    type: 'duplicate_reporting',
                    severity: 'high',
                    title: 'Duplicate Account Reporting',
                    description: 'Same account appears multiple times on your report.',
                    strategy: 'This is an FCRA violation. The same debt cannot be reported multiple times. Demand removal of duplicates immediately.'
                });
            }
            
            // Check for old accounts
            const yearPattern = /20\d{2}/g;
            const years = text.match(yearPattern) || [];
            const currentYear = new Date().getFullYear();
            const oldYears = years.filter(y => currentYear - parseInt(y) > 7);
            
            if (oldYears.length > 0) {
                discrepancies.push({
                    type: 'old_account',
                    severity: 'high',
                    title: 'Account Older Than 7 Years',
                    description: `Account dates back to ${Math.min(...oldYears)} - over 7 years old.`,
                    strategy: 'FCRA requires removal of negative items after 7 years from first delinquency. This item must be deleted.'
                });
            }
            
            return discrepancies;
        }
        
        function displayExtractedData() {
            const container = document.getElementById('extractedFields');
            container.innerHTML = '';
            
            const fields = [
                { label: 'Name', value: extractedData.name, confidence: extractedData.name ? 'high' : 'low' },
                { label: 'Address', value: extractedData.address, confidence: extractedData.address ? 'high' : 'low' },
                { label: 'SSN Last 4', value: extractedData.ssn, confidence: extractedData.ssn ? 'medium' : 'low' },
                { label: 'Negative Items Found', value: extractedData.negativeItems?.length + ' items detected', confidence: extractedData.negativeItems?.length > 0 ? 'high' : 'medium' },
                { label: 'Discrepancies', value: extractedData.discrepancies?.length + ' issues found', confidence: 'high' }
            ];
            
            fields.forEach(field => {
                if (field.value) {
                    container.innerHTML += `
                        <div class="extracted-field">
                            <label>${field.label}:</label>
                            <div class="value">${field.value}</div>
                            <span class="confidence confidence-${field.confidence}">${field.confidence}</span>
                        </div>
                    `;
                }
            });
            
            document.getElementById('extractedDataSection').classList.remove('hidden');
        }
        
        function autoFillForm() {
            if (extractedData.name) {
                document.getElementById('clientName').value = extractedData.name;
                document.getElementById('clientName').classList.add('auto-filled');
            }
            if (extractedData.address) {
                document.getElementById('clientAddress').value = extractedData.address;
                document.getElementById('clientAddress').classList.add('auto-filled');
            }
            if (extractedData.ssn) {
                document.getElementById('ssnLast4').value = extractedData.ssn;
                document.getElementById('ssnLast4').classList.add('auto-filled');
            }
            
            // Auto-check detected negative items
            if (extractedData.negativeItems) {
                extractedData.negativeItems.forEach(item => {
                    const checkbox = document.querySelector(`input[name="negativeItems"][value="${item}"]`);
                    if (checkbox) {
                        checkbox.checked = true;
                        checkbox.closest('.checkbox-item').classList.add('selected');
                    }
                });
            }
        }
        
        function analyzeUploadedReport() {
            switchTab('manual');
            document.querySelectorAll('.tab')[1].click();
            analyzeForm();
        }
        
        function analyzeForm() {
            const negativeItems = Array.from(document.querySelectorAll('input[name="negativeItems"]:checked')).map(cb => cb.value);
            const errors = Array.from(document.querySelectorAll('input[name="errors"]:checked')).map(cb => cb.value);
            const bureaus = Array.from(document.querySelectorAll('input[name="bureaus"]:checked')).map(cb => cb.value);
            
            // Update dashboard
            const totalDisc = (extractedData.discrepancies?.length || 0) + errors.length;
            document.getElementById('totalDiscrepancies').textContent = totalDisc;
            document.getElementById('highPriorityItems').textContent = errors.filter(e => 
                ['not_mine', 'old_account', 'duplicate_entry'].includes(e)).length;
            document.getElementById('totalBureaus').textContent = bureaus.length;
            
            // Calculate estimated points
            let points = 0;
            if (negativeItems.includes('collections')) points += 30;
            if (negativeItems.includes('charge_off')) points += 40;
            if (negativeItems.includes('late_payment')) points += 20;
            if (negativeItems.includes('hard_inquiry')) points += 5;
            document.getElementById('estimatedPoints').textContent = '+' + Math.min(points, 150);
            
            // Build discrepancy analysis
            let analysisHTML = '<h2>üîç Discrepancy Analysis & Dispute Strategy</h2>';
            
            // Show extracted discrepancies
            if (extractedData.discrepancies?.length > 0) {
                extractedData.discrepancies.forEach(disc => {
                    analysisHTML += createDiscrepancyCard(disc);
                });
            }
            
            // Show selected error strategies
            errors.forEach(error => {
                analysisHTML += createErrorStrategyCard(error);
            });
            
            if (analysisHTML === '<h2>üîç Discrepancy Analysis & Dispute Strategy</h2>') {
                analysisHTML += '<p>Please select negative items and error types above to see dispute strategies.</p>';
            }
            
            document.getElementById('discrepancyAnalysis').innerHTML = analysisHTML;
            
            // Generate letters
            generateLetters();
            
            // Show results
            document.getElementById('results').style.display = 'block';
            document.getElementById('results').scrollIntoView({ behavior: 'smooth' });
        }
        
        function createDiscrepancyCard(disc) {
            return `
                <div class="discrepancy-card ${disc.severity}">
                    <div class="discrepancy-header">
                        <div class="discrepancy-title">${disc.title}</div>
                        <span class="discrepancy-severity severity-${disc.severity}">${disc.severity}</span>
                    </div>
                    <div class="discrepancy-content">
                        <p><strong>Issue Found:</strong> ${disc.description}</p>
                    </div>
                    <div class="dispute-strategy">
                        <h4>üéØ How to Dispute This</h4>
                        <p>${disc.strategy}</p>
                        
                        <div class="why-box">
                            <h4>üí° Why This Works</h4>
                            <ul>
                                <li>FCRA requires 100% accuracy in credit reporting</li>
                                <li>Bureaus must verify or delete within 30 days</li>
                                <li>Most creditors don't maintain proper documentation</li>
                                <li>Discrepancies prove lack of verification</li>
                            </ul>
                        </div>
                    </div>
                </div>
            `;
        }
        
        function createErrorStrategyCard(error) {
            const strategies = {
                not_mine: {
                    title: 'Account Not Mine / Identity Theft',
                    severity: 'high',
                    description: 'You have no knowledge of this account and did not authorize it.',
                    steps: [
                        { title: 'File Police Report', desc: 'If fraud, file identity theft report with local police' },
                        { title: 'Request Full Deletion', desc: 'Demand immediate removal as fraudulent account' },
                        { title: 'Freeze Your Credit', desc: 'Prevent further fraudulent accounts' }
                    ],
                    law: 'FCRA ¬ß 605B requires bureaus to block fraudulent information within 4 business days'
                },
                date_inaccurate: {
                    title: 'Inaccurate Dates / Re-aging',
                    severity: 'high',
                    description: 'Dates don\'t match your records or were changed to extend reporting period.',
                    steps: [
                        { title: 'Document Correct Dates', desc: 'Gather payment records, statements showing correct dates' },
                        { title: 'Calculate 7-Year Clock', desc: 'Verify when item should fall off (7 years from first delinquency)' },
                        { title: 'Dispute Re-aging', desc: 'Illegal to change dates to keep item on report longer' }
                    ],
                    law: 'FCRA ¬ß 605(a) - Negative items can only report for 7 years (10 for bankruptcy)'
                },
                paid_still_reporting: {
                    title: 'Paid But Still Negative',
                    severity: 'medium',
                    description: 'Account was paid/settled but still showing negative status.',
                    steps: [
                        { title: 'Send Proof of Payment', desc: 'Include bank statements or paid-in-full letters' },
                        { title: 'Demand Status Update', desc: 'Must report as paid with zero balance' },
                        { title: 'Request Removal', desc: 'Some creditors will delete for goodwill after payment' }
                    ],
                    law: 'FCRA requires accurate reporting of payment status and current balance'
                },
                duplicate_entry: {
                    title: 'Duplicate Account Reporting',
                    severity: 'high',
                    description: 'Same debt reported by original creditor AND collection agency.',
                    steps: [
                        { title: 'Identify Both Entries', desc: 'List both creditor and collection agency accounts' },
                        { title: 'Demand Removal of Duplicate', desc: 'Only one entity can report the same debt' },
                        { title: 'Cite FCRA Violation', desc: 'Duplicate reporting violates FCRA accuracy requirements' }
                    ],
                    law: 'Same debt cannot be double-reported. This is an automatic FCRA violation.'
                },
                old_account: {
                    title: 'Account Over 7 Years Old',
                    severity: 'high',
                    description: 'Negative item is past the legal reporting limit.',
                    steps: [
                        { title: 'Calculate Date', desc: '7 years from first delinquency, NOT last payment' },
                        { title: 'Demand Immediate Removal', desc: 'No investigation needed - must delete' },
                        { title: 'Threaten Legal Action', desc: 'Willful non-compliance with FCRA allows lawsuits' }
                    ],
                    law: 'FCRA ¬ß 605(a) - Obsolete information cannot be reported (7-year rule)'
                },
                incorrect_balance: {
                    title: 'Incorrect Balance/Credit Limit',
                    severity: 'medium',
                    description: 'Balance or credit limit does not match your records.',
                    steps: [
                        { title: 'Gather Documentation', desc: 'Collect statements showing correct amounts' },
                        { title: 'Dispute Specific Amount', desc: 'State exactly what the correct balance should be' },
                        { title: 'Request Recalculation', desc: 'If high utilization shown, this affects score significantly' }
                    ],
                    law: 'FCRA ¬ß 607 requires reasonable procedures to ensure maximum possible accuracy'
                },
                unauthorized_inquiry: {
                    title: 'Unauthorized Credit Inquiry',
                    severity: 'low',
                    description: 'Hard inquiry without your permission or knowledge.',
                    steps: [
                        { title: 'Identify the Inquirer', desc: 'Note which company pulled your credit' },
                        { title: 'Check Your Records', desc: 'Verify you did not apply for credit with this company' },
                        { title: 'Demand Proof of Authorization', desc: 'They must provide signed application with your signature' }
                    ],
                    law: 'FCRA ¬ß 604 - Inquiries must have permissible purpose. Unauthorized inquiries violate your rights.'
                }
            };
            
            const strat = strategies[error];
            if (!strat) return '';
            
            let stepsHTML = strat.steps.map((step, i) => `
                <div class="strategy-step">
                    <div class="step-number">${i + 1}</div>
                    <div class="step-content">
                        <h5>${step.title}</h5>
                        <p>${step.desc}</p>
                    </div>
                </div>
            `).join('');
            
            return `
                <div class="discrepancy-card ${strat.severity}">
                    <div class="discrepancy-header">
                        <div class="discrepancy-title">${strat.title}</div>
                        <span class="discrepancy-severity severity-${strat.severity}">${strat.severity}</span>
                    </div>
                    <div class="discrepancy-content">
                        <p><strong>The Problem:</strong> ${strat.description}</p>
                    </div>
                    <div class="dispute-strategy">
                        <h4>üéØ Dispute Strategy</h4>
                        ${stepsHTML}
                        
                        <div class="legal-box">
                            <h5>‚öñÔ∏è Legal Basis</h5>
                            <p>${strat.law}</p>
                        </div>
                        
                        <div class="why-box">
                            <h4>üí° Why This Dispute Works</h4>
                            <ul>
                                <li>Credit bureaus rely on automated systems - disputes disrupt these systems</li>
                                <li>Most creditors don't keep detailed records past 2-3 years</li>
                                <li>If they can't verify within 30 days, they MUST delete</li>
                                <li>Your dispute creates a paper trail showing you contested the debt</li>
                            </ul>
                        </div>
                    </div>
                </div>
            `;
        }
        
        function generateLetters() {
            const formData = {
                clientName: document.getElementById('clientName').value,
                clientEmail: document.getElementById('clientEmail').value,
                clientAddress: document.getElementById('clientAddress').value,
                ssnLast4: document.getElementById('ssnLast4').value,
                creditorName: document.getElementById('creditorName').value,
                accountNumber: document.getElementById('accountNumber').value,
                additionalNotes: document.getElementById('additionalNotes').value
            };
            
            const errors = Array.from(document.querySelectorAll('input[name="errors"]:checked')).map(cb => cb.value);
            const bureaus = Array.from(document.querySelectorAll('input[name="bureaus"]:checked')).map(cb => cb.value);
            
            let disputeReason = '';
            if (errors.includes('not_mine')) {
                disputeReason = 'I have no knowledge of this account. This appears to be fraudulent or a case of identity theft. I did not authorize this account and request immediate removal under FCRA ¬ß 605B.';
            } else if (errors.includes('date_inaccurate')) {
                disputeReason = 'The dates reported are inaccurate. This item may have been re-aged illegally. Under FCRA ¬ß 605(a), negative items can only report for 7 years from the date of first delinquency.';
            } else if (errors.includes('paid_still_reporting')) {
                disputeReason = 'This account has been paid/settled but continues to report inaccurately. The current status and balance are incorrect per my records.';
            } else if (errors.includes('duplicate_entry')) {
                disputeReason = 'This debt is being reported multiple times, constituting duplicate reporting. This violates FCRA accuracy requirements.';
            } else if (errors.includes('old_account')) {
                disputeReason = 'This account exceeds the 7-year reporting limit under FCRA ¬ß 605(a). This obsolete information must be removed immediately.';
            } else if (errors.includes('incorrect_balance')) {
                disputeReason = 'The balance and/or credit limit reported is inaccurate per my records. This incorrect information is negatively impacting my credit score.';
            } else if (errors.includes('unauthorized_inquiry')) {
                disputeReason = 'I did not authorize this credit inquiry. I have no record of applying for credit with this entity. This inquiry lacks permissible purpose under FCRA ¬ß 604.';
            } else {
                disputeReason = 'I dispute the accuracy of this information. Under FCRA ¬ß 611, I request verification of all reported data.';
            }
            
            formData.disputeReason = disputeReason;
            
            const letterTemplates = {
                experian: (data) => `Experian
P.O. Box 4500
Allen, TX 75013

${new Date().toLocaleDateString()}

Re: Formal Credit Report Dispute
Name: ${data.clientName}
SSN: XXX-XX-${data.ssnLast4}
Address: ${data.clientAddress}

Dear Experian,

I am writing to formally dispute the following account appearing on my credit report:

CREDITOR: ${data.creditorName}
ACCOUNT: ${data.accountNumber || 'See attached report'}

DISPUTE REASON:
${data.disputeReason}

${data.additionalNotes ? 'ADDITIONAL DETAILS:\n' + data.additionalNotes + '\n\n' : ''}
Under the Fair Credit Reporting Act (FCRA), you are required to:

1. Conduct a reasonable investigation within 30 days
2. Verify ALL information with the original creditor
3. Delete any information that cannot be verified
4. Provide me with written results of your investigation
5. Send an updated copy of my credit report

Please be advised that this dispute is not frivolous. I have identified specific inaccuracies that require your immediate attention.

If you cannot verify this account as accurate, you MUST delete it per FCRA requirements.

Enclosed: Copy of ID, Proof of Address

Sincerely,

${data.clientName}

CC: Consumer Financial Protection Bureau`,

                equifax: (data) => `Equifax Information Services
P.O. Box 740256
Atlanta, GA 30374

${new Date().toLocaleDateString()}

Re: Formal Credit Report Dispute
Name: ${data.clientName}
SSN: XXX-XX-${data.ssnLast4}
Address: ${data.clientAddress}

Dear Equifax,

I am writing to formally dispute the following account appearing on my credit report:

CREDITOR: ${data.creditorName}
ACCOUNT: ${data.accountNumber || 'See attached report'}

DISPUTE REASON:
${data.disputeReason}

${data.additionalNotes ? 'ADDITIONAL DETAILS:\n' + data.additionalNotes + '\n\n' : ''}
Under the Fair Credit Reporting Act (FCRA), you are required to:

1. Conduct a reasonable investigation within 30 days
2. Verify ALL information with the original creditor
3. Delete any information that cannot be verified
4. Provide me with written results of your investigation
5. Send an updated copy of my credit report

Please be advised that this dispute is not frivolous. I have identified specific inaccuracies that require your immediate attention.

If you cannot verify this account as accurate, you MUST delete it per FCRA requirements.

Enclosed: Copy of ID, Proof of Address

Sincerely,

${data.clientName}

CC: Consumer Financial Protection Bureau`,

                transunion: (data) => `TransUnion LLC
Consumer Dispute Center
P.O. Box 2000
Chester, PA 19016

${new Date().toLocaleDateString()}

Re: Formal Credit Report Dispute
Name: ${data.clientName}
SSN: XXX-XX-${data.ssnLast4}
Address: ${data.clientAddress}

Dear TransUnion,

I am writing to formally dispute the following account appearing on my credit report:

CREDITOR: ${data.creditorName}
ACCOUNT: ${data.accountNumber || 'See attached report'}

DISPUTE REASON:
${data.disputeReason}

${data.additionalNotes ? 'ADDITIONAL DETAILS:\n' + data.additionalNotes + '\n\n' : ''}
Under the Fair Credit Reporting Act (FCRA), you are required to:

1. Conduct a reasonable investigation within 30 days
2. Verify ALL information with the original creditor
3. Delete any information that cannot be verified
4. Provide me with written results of your investigation
5. Send an updated copy of my credit report

Please be advised that this dispute is not frivolous. I have identified specific inaccuracies that require your immediate attention.

If you cannot verify this account as accurate, you MUST delete it per FCRA requirements.

Enclosed: Copy of ID, Proof of Address

Sincerely,

${data.clientName}

CC: Consumer Financial Protection Bureau`
            };
            
            let lettersHTML = '';
            bureaus.forEach(bureau => {
                const letter = letterTemplates[bureau](formData);
                lettersHTML += `
                    <div style="margin-bottom: 40px;">
                        <h3>üì® ${bureau.toUpperCase()} Dispute Letter</h3>
                        <div class="letter-preview" id="letter-${bureau}">${letter}</div>
                        <div style="margin-top: 20px; text-align: center;">
                            <button class="btn btn-secondary" onclick="copyLetter('letter-${bureau}')">üìã Copy</button>
                            <button class="btn btn-success" onclick="downloadLetter('${bureau}')">üíæ Download</button>
                            <button class="btn" onclick="printLetter('${bureau}')">üñ®Ô∏è Print</button>
                            <button class="btn btn-danger" onclick="emailLetter('${bureau}')">üìß Email</button>
                        </div>
                    </div>
                `;
            });
            
            document.getElementById('letters').innerHTML = lettersHTML;
        }
        
        function copyLetter(id) {
            navigator.clipboard.writeText(document.getElementById(id).textContent).then(() => alert('Copied!'));
        }
        
        function downloadLetter(bureau) {
            const text = document.getElementById(`letter-${bureau}`).textContent;
            const blob = new Blob([text], { type: 'text/plain' });
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = `Dispute_${bureau}_${new Date().toISOString().split('T')[0]}.txt`;
            a.click();
        }
        
        function printLetter(bureau) {
            const content = document.getElementById(`letter-${bureau}`).textContent;
            const w = window.open('', '_blank');
            w.document.write(`<html><body style="font-family:monospace;white-space:pre-wrap;padding:40px;">${content.replace(/\n/g, '<br>')}</body></html>`);
            w.document.close();
            w.print();
        }
        
        function emailLetter(bureau) {
            const email = document.getElementById('clientEmail').value;
            const subject = encodeURIComponent(`Your Dispute Letter - ${bureau.toUpperCase()}`);
            const body = encodeURIComponent(document.getElementById(`letter-${bureau}`).textContent);
            window.open(`mailto:${email}?subject=${subject}&body=${body}`);
        }
        
        // Checkbox selection highlighting
        document.addEventListener('change', (e) => {
            if (e.target.matches('.checkbox-item input')) {
                e.target.closest('.checkbox-item').classList.toggle('selected', e.target.checked);
            }
        });
    </script>
</body>
</html>
